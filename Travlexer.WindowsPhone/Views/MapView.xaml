<phone:PhoneApplicationPage x:Class="Travlexer.WindowsPhone.Views.MapView"
							xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
							xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
							xmlns:Behaviors="clr-namespace:Travlexer.WindowsPhone.Core.Behaviors;assembly=Travlexer.WindowsPhone.Core"
							xmlns:Controls="clr-namespace:Travlexer.WindowsPhone.Controls"
							xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
							xmlns:ec="clr-namespace:Microsoft.Expression.Interactivity.Core;assembly=Microsoft.Expression.Interactions"
							xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
							xmlns:Maps="clr-namespace:Microsoft.Phone.Controls.Maps;assembly=Microsoft.Phone.Controls.Maps"
							xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
							xmlns:phone="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone"
							xmlns:shell="clr-namespace:Microsoft.Phone.Shell;assembly=Microsoft.Phone"
							xmlns:Triggers="clr-namespace:Travlexer.WindowsPhone.Core.Triggers;assembly=Travlexer.WindowsPhone.Core"
							xmlns:ViewModels="clr-namespace:Travlexer.WindowsPhone.ViewModels"
							xmlns:toolkit="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone.Controls.Toolkit"
							xmlns:Icons="clr-namespace:Travlexer.WindowsPhone.Controls.Icons"
							xmlns:TriggerActions="clr-namespace:Travlexer.WindowsPhone.Core.TriggerActions;assembly=Travlexer.WindowsPhone.Core"
							Style="{StaticResource PageDefault}"
							x:Name="Self"
							FontFamily="{StaticResource PhoneFontFamilyNormal}"
							FontSize="{StaticResource PhoneFontSizeNormal}"
							Foreground="{StaticResource PhoneForegroundBrush}"
							Orientation="Portrait"
							mc:Ignorable="d"
							d:DesignWidth="480"
							d:DesignHeight="696"
							shell:SystemTray.IsVisible="True"
							d:DataContext="{Binding MapViewModel, Source={StaticResource DesignTime}}">
	<phone:PhoneApplicationPage.DataContext>
		<ViewModels:MapViewModel />
	</phone:PhoneApplicationPage.DataContext>
	<Grid>
		<VisualStateManager.VisualStateGroups>
			<VisualStateGroup x:Name="VisualStates">
				<VisualStateGroup.Transitions>
					<VisualTransition GeneratedDuration="0:0:0.3"
									  GeneratedEasingFunction="{StaticResource EasingQuinticOut}"
									  To="PushpinSelected">
						<Storyboard>
							<ObjectAnimationUsingKeyFrames Storyboard.TargetName="SelectedPushpinBackground"
														   Storyboard.TargetProperty="(UIElement.Visibility)">
								<DiscreteObjectKeyFrame KeyTime="0">
									<DiscreteObjectKeyFrame.Value>
										<Visibility>Visible</Visibility>
									</DiscreteObjectKeyFrame.Value>
								</DiscreteObjectKeyFrame>
							</ObjectAnimationUsingKeyFrames>
							<ObjectAnimationUsingKeyFrames Storyboard.TargetName="SelectedPushpinContent"
														   Storyboard.TargetProperty="(PushpinOverlay.VisualState)">
								<DiscreteObjectKeyFrame KeyTime="0">
									<DiscreteObjectKeyFrame.Value>
										<ViewModels:PushpinOverlayVisualStates>Expanded</ViewModels:PushpinOverlayVisualStates>
									</DiscreteObjectKeyFrame.Value>
								</DiscreteObjectKeyFrame>
							</ObjectAnimationUsingKeyFrames>
							<ObjectAnimationUsingKeyFrames Storyboard.TargetName="SelectedPushpin"
														   Storyboard.TargetProperty="(UIElement.Visibility)">
								<DiscreteObjectKeyFrame KeyTime="0">
									<DiscreteObjectKeyFrame.Value>
										<Visibility>Visible</Visibility>
									</DiscreteObjectKeyFrame.Value>
								</DiscreteObjectKeyFrame>
							</ObjectAnimationUsingKeyFrames>
						</Storyboard>
					</VisualTransition>
					<VisualTransition From="PushpinSelected"
									  GeneratedDuration="0:0:0.2">
						<Storyboard>
							<ObjectAnimationUsingKeyFrames Storyboard.TargetName="SelectedPushpinBackground"
														   Storyboard.TargetProperty="(UIElement.Visibility)">
								<DiscreteObjectKeyFrame KeyTime="0:0:0.2">
									<DiscreteObjectKeyFrame.Value>
										<Visibility>Collapsed</Visibility>
									</DiscreteObjectKeyFrame.Value>
								</DiscreteObjectKeyFrame>
							</ObjectAnimationUsingKeyFrames>
						</Storyboard>
					</VisualTransition>
					<VisualTransition To="Search">
						<Storyboard>
							<DoubleAnimation Duration="0:0:0.3"
											 EasingFunction="{StaticResource EasingQuinticOut}"
											 To="1"
											 Storyboard.TargetProperty="(UIElement.Opacity)"
											 Storyboard.TargetName="SearchBackground" />
							<DoubleAnimation Duration="0:0:0.3"
											 EasingFunction="{StaticResource EasingQuinticOut}"
											 To="0"
											 Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)"
											 Storyboard.TargetName="SearchContentPanel" />
							<ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Visibility)"
														   Storyboard.TargetName="SearchPanel">
								<DiscreteObjectKeyFrame KeyTime="0">
									<DiscreteObjectKeyFrame.Value>
										<Visibility>Visible</Visibility>
									</DiscreteObjectKeyFrame.Value>
								</DiscreteObjectKeyFrame>
							</ObjectAnimationUsingKeyFrames>
						</Storyboard>
					</VisualTransition>
					<VisualTransition From="Search"
									  GeneratedDuration="0">
						<Storyboard>
							<DoubleAnimation Duration="0:0:0.2"
											 Storyboard.TargetProperty="(UIElement.Opacity)"
											 Storyboard.TargetName="SearchBackground"
											 EasingFunction="{StaticResource EasingQuinticOut}" />
							<DoubleAnimation Duration="0:0:0.2"
											 Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)"
											 Storyboard.TargetName="SearchContentPanel"
											 EasingFunction="{StaticResource EasingQuinticOut}" />
							<ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Visibility)"
														   Storyboard.TargetName="SearchPanel">
								<DiscreteObjectKeyFrame KeyTime="0:0:0.2">
									<DiscreteObjectKeyFrame.Value>
										<Visibility>Collapsed</Visibility>
									</DiscreteObjectKeyFrame.Value>
								</DiscreteObjectKeyFrame>
							</ObjectAnimationUsingKeyFrames>
						</Storyboard>
					</VisualTransition>
				</VisualStateGroup.Transitions>
				<VisualState x:Name="Default" />
				<VisualState x:Name="Search">
					<Storyboard>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Visibility)"
													   Storyboard.TargetName="SearchPanel">
							<DiscreteObjectKeyFrame KeyTime="0">
								<DiscreteObjectKeyFrame.Value>
									<Visibility>Visible</Visibility>
								</DiscreteObjectKeyFrame.Value>
							</DiscreteObjectKeyFrame>
						</ObjectAnimationUsingKeyFrames>
						<DoubleAnimation Duration="0"
										 To="1"
										 Storyboard.TargetProperty="(UIElement.Opacity)"
										 Storyboard.TargetName="SearchBackground"
										 d:IsOptimized="True" />
						<DoubleAnimation Duration="0"
										 To="0"
										 Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)"
										 Storyboard.TargetName="SearchContentPanel"
										 d:IsOptimized="True" />
					</Storyboard>
				</VisualState>
				<VisualState x:Name="PushpinSelected">
					<Storyboard>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="SelectedPushpinContent"
													   Storyboard.TargetProperty="(PushpinOverlay.VisualState)">
							<DiscreteObjectKeyFrame KeyTime="0">
								<DiscreteObjectKeyFrame.Value>
									<ViewModels:PushpinOverlayVisualStates>Expanded</ViewModels:PushpinOverlayVisualStates>
								</DiscreteObjectKeyFrame.Value>
							</DiscreteObjectKeyFrame>
						</ObjectAnimationUsingKeyFrames>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="SelectedPushpinBackground"
													   Storyboard.TargetProperty="(UIElement.Visibility)">
							<DiscreteObjectKeyFrame KeyTime="0">
								<DiscreteObjectKeyFrame.Value>
									<Visibility>Visible</Visibility>
								</DiscreteObjectKeyFrame.Value>
							</DiscreteObjectKeyFrame>
						</ObjectAnimationUsingKeyFrames>
						<DoubleAnimation Storyboard.TargetName="SelectedPushpinBackground"
										 Storyboard.TargetProperty="(UIElement.Opacity)"
										 Duration="0"
										 To="1"
										 d:IsOptimized="True" />
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="SelectedPushpin"
													   Storyboard.TargetProperty="(UIElement.Visibility)">
							<DiscreteObjectKeyFrame KeyTime="0">
								<DiscreteObjectKeyFrame.Value>
									<Visibility>Visible</Visibility>
								</DiscreteObjectKeyFrame.Value>
							</DiscreteObjectKeyFrame>
						</ObjectAnimationUsingKeyFrames>
					</Storyboard>
				</VisualState>
			</VisualStateGroup>
		</VisualStateManager.VisualStateGroups>
		<Maps:Map x:Name="Map"
				  Center="{Binding MapCenter, Converter={StaticResource LocationGeoCoordinateConverter}, Mode=TwoWay}"
				  CopyrightVisibility="Collapsed"
				  LogoVisibility="Collapsed"
				  CredentialsProvider="AiEEQMxcy4psQQEr7jujXL34vU9268zhPAWJRgDcHNpKdKwyP0TxZRiLOX6j2CMW">
			<Maps:MapItemsControl IsHitTestVisible="False"
								  ItemsSource="{Binding Pushpins}">
				<Maps:MapItemsControl.ItemTemplate>
					<DataTemplate>
						<Maps:Pushpin Style="{StaticResource PushpinShadow}"
									  Location="{Binding Data.Location, Converter={StaticResource LocationGeoCoordinateConverter}, Mode=TwoWay}"
									  PositionOrigin="BottomCenter" />
					</DataTemplate>
				</Maps:MapItemsControl.ItemTemplate>
			</Maps:MapItemsControl>
			<Maps:MapItemsControl ItemsSource="{Binding Pushpins}">
				<i:Interaction.Behaviors>
					<Behaviors:CancelGestureEventBehavior />
				</i:Interaction.Behaviors>
				<Maps:MapItemsControl.ItemTemplate>
					<DataTemplate>
						<Maps:Pushpin x:Name="Pushpin"
									  Background="{Binding Data.Color, Converter={StaticResource PlaceColorToHexConverter}}"
									  Location="{Binding Data.Location, Converter={StaticResource LocationGeoCoordinateConverter}, Mode=TwoWay}"
									  PositionOrigin="BottomCenter">
							<i:Interaction.Triggers>
								<i:EventTrigger EventName="Tap">
									<i:InvokeCommandAction Command="{Binding Parent.CommandSelectPushpin, Mode=OneTime}"
														   CommandParameter="{Binding}" />
								</i:EventTrigger>
								<i:EventTrigger>
									<ec:GoToStateAction StateName="Loaded"
														TargetObject="{Binding ElementName=Pushpin}" />
								</i:EventTrigger>
							</i:Interaction.Triggers>
							<ContentPresenter Height="32"
											  Width="32"
											  Content="{Binding Data.Icon, Converter={StaticResource PlaceIconToControlConverter}}" />
						</Maps:Pushpin>
					</DataTemplate>
				</Maps:MapItemsControl.ItemTemplate>
			</Maps:MapItemsControl>
			<Rectangle x:Name="SelectedPushpinBackground"
					   Fill="#60000000"
					   IsHitTestVisible="False"
					   Opacity="0"
					   Visibility="Collapsed" />
			<Maps:MapLayer>
				<i:Interaction.Behaviors>
					<Behaviors:CancelGestureEventBehavior />
				</i:Interaction.Behaviors>
				<Maps:Pushpin x:Name="SelectedPushpin"
							  Background="{Binding Data.Color, Converter={StaticResource PlaceColorToHexConverter}}"
							  DataContext="{Binding SelectedPushpin}"
							  Location="{Binding Data.Location, Converter={StaticResource LocationGeoCoordinateConverter}, Mode=TwoWay}"
							  Visibility="Collapsed"
							  PositionOrigin="BottomCenter">
					<i:Interaction.Triggers>
						<i:EventTrigger EventName="Tap">
							<i:InvokeCommandAction Command="{Binding Parent.CommandDeselectPushpin, Mode=OneTime}"
												   CommandParameter="{Binding}" />
						</i:EventTrigger>
						<i:EventTrigger>
							<ec:GoToStateAction StateName="Loaded"
												TargetObject="{Binding ElementName=SelectedPushpin}"
												UseTransitions="False" />
						</i:EventTrigger>
						<Triggers:RootManipulationTrigger>
							<i:InvokeCommandAction Command="{Binding Parent.CommandDeselectPushpin, Mode=OneTime}"
												   CommandParameter="{Binding}" />
						</Triggers:RootManipulationTrigger>
					</i:Interaction.Triggers>
					<Controls:PushpinContent x:Name="SelectedPushpinContent"
											 Address="{Binding Data.FormattedAddress}"
											 CommandDelete="{Binding Parent.CommandDeletePlace, Mode=OneTime}"
											 CommandDeleteParameter="{Binding}"
											 CommandPinSearchResult="{Binding Parent.CommandPinSearchResult, Mode=OneTime}"
											 CommandPinSearchResultParameter="{Binding}"
											 Icon="{Binding Data.Icon}"
											 Title="{Binding Data.Name}"
											 VisualState="Collapsed"
											 WorkingState="{Binding WorkingState}" />
				</Maps:Pushpin>
			</Maps:MapLayer>
		</Maps:Map>
		<Grid x:Name="SearchPanel"
			  Visibility="Collapsed">
			<Rectangle Fill="#60000000"
					   x:Name="SearchBackground"
					   Opacity="0" 
					   IsHitTestVisible="False"/>
			<Grid VerticalAlignment="Top"
				  x:Name="SearchContentPanel"
				  Height="72"
				  Background="{StaticResource PhoneChromeBrush}">
				<i:Interaction.Triggers>
					<Triggers:RootManipulationTrigger>
						<ec:GoToStateAction TargetObject="{Binding ElementName=Self}"
											StateName="Default"
											IsEnabled="{Binding Visibility, ElementName=SearchPanel, Converter={StaticResource BooleanConverter}}" />
					</Triggers:RootManipulationTrigger>
				</i:Interaction.Triggers>
				<Grid.RenderTransform>
					<CompositeTransform TranslateY="-72" />
				</Grid.RenderTransform>
				<Grid.ColumnDefinitions>
					<ColumnDefinition />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>
				<toolkit:AutoCompleteBox x:Name="SearchBox"
										 Text="{Binding Input, Mode=TwoWay}">
					<toolkit:AutoCompleteBox.InputScope>
						<InputScope>
							<InputScopeName NameValue="Search" />
						</InputScope>
					</toolkit:AutoCompleteBox.InputScope>
					<i:Interaction.Triggers>
						<Triggers:KeyPressTrigger Key="Enter">
							<i:InvokeCommandAction Command="{Binding CommandSearch, Mode=OneTime}" />
							<ec:GoToStateAction TargetObject="{Binding ElementName=Self}"
												StateName="Default"
												IsEnabled="{Binding Input, Converter={StaticResource BooleanConverter}}"/>
							<TriggerActions:FocusAction TargetObject="{Binding ElementName=Self}" />
						</Triggers:KeyPressTrigger>
					</i:Interaction.Triggers>
				</toolkit:AutoCompleteBox>
				<Controls:ButtonCircle VerticalAlignment="Center"
									   Grid.Column="1">
					<i:Interaction.Triggers>
						<i:EventTrigger EventName="Tap">
							<ec:GoToStateAction TargetObject="{Binding ElementName=Self}"
												StateName="Default"
												IsEnabled="{Binding Input, Converter={StaticResource BooleanConverter}}"/>
							<i:InvokeCommandAction Command="{Binding CommandSearch, Mode=OneTime}"
												   IsEnabled="{Binding Input, Converter={StaticResource BooleanConverter}}"/>
							<TriggerActions:FocusAction TargetObject="{Binding ElementName=Self}"/>
						</i:EventTrigger>
					</i:Interaction.Triggers>
					<Icons:Search2 />
				</Controls:ButtonCircle>
			</Grid>
		</Grid>
	</Grid>
	<phone:PhoneApplicationPage.ApplicationBar>
		<shell:ApplicationBar x:Name="PhoneApplicationBar"
							  IsVisible="True">
			<!--<shell:ApplicationBar.MenuItems>
				<shell:ApplicationBarMenuItem x:Name="AppBarMenuItemItinerary"
											  Click="AppBarMenuItemItineraryClick"
											  IsEnabled="False"
											  Text="itinerary" />
				<shell:ApplicationBarMenuItem x:Name="AppBarMenuItemClearSearch"
											  Click="AppBarMenuItemClearSearchClick"
											  Text="clear search" />
				<shell:ApplicationBarMenuItem x:Name="AppBarMenuItemClearRoute"
											  Click="AppBarMenuItemClearRouteClick"
											  Text="clear route" />
				<shell:ApplicationBarMenuItem x:Name="AppBarMenuItemSync"
											  Click="AppBarMenuItemSyncClick"
											  Text="sync" />
				<shell:ApplicationBarMenuItem x:Name="AppBarMenuItemMore"
											  Click="AppBarMenuItemMoreClick"
											  Text="more..." />
			</shell:ApplicationBar.MenuItems>-->
			<!--<shell:ApplicationBarIconButton x:Name="AppButtonCurrentLocation"
											Click="AppButtonCurrentLocationClick"
											IconUri="/Resources/Icons/Location.png"
											IsEnabled="False"
											Text="me" />-->
			<shell:ApplicationBarIconButton x:Name="AppButtonSearch"
											Click="OnAppButtonSearchClick"
											IconUri="/Resources/Icons/Search.png"
											Text="search" />
			<!--<shell:ApplicationBarIconButton x:Name="AppButtonDirections"
											Click="AppButtonDirectionsClick"
											IconUri="/Resources/Icons/Directions.png"
											Text="directions" />
			<shell:ApplicationBarIconButton x:Name="AppButtonLayers"
											Click="AppButtonLayersClick"
											IconUri="/Resources/Icons/Layers.png"
											Text="layers" />-->
		</shell:ApplicationBar>
	</phone:PhoneApplicationPage.ApplicationBar>
</phone:PhoneApplicationPage>